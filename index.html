<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Erg√ºnus Maximus Side Scroller</title>
<style>
  body { margin:0; background:#000; overflow:hidden; font-family:Arial; }
  canvas { display:block; margin:0 auto; background:#111; image-rendering: pixelated; }
  .ui {
    position:absolute; top:10px; left:10px;
    color:#fff; font-size:14px;
    text-shadow:0 0 6px #000;
    background:rgba(0,0,0,0.4);
    padding:10px; border-radius:10px;
    border:1px solid rgba(255,255,255,0.15);
  }
  .bigmsg {
    position:absolute;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    color:#fff;
    font-size:28px;
    text-align:center;
    text-shadow:0 0 10px #000;
    pointer-events:none;
  }
</style>
</head>
<body>

<div class="ui" id="ui">
  <b>ERG√úNUS MAXIMUS</b><br>
  HP: <span id="hp">100</span> | Skor: <span id="score">0</span><br>
  <small>WASD Hareket | J Yumruk | K Tekme</small>
</div>

<div class="bigmsg" id="msg">üèÉ‚Äç‚ôÇÔ∏è Side-Scroller Modu<br><span style="font-size:16px;">D√º≈ümanlar geliyor. Patlaklƒ±k yayƒ±lƒ±yor.</span></div>

<canvas id="game" width="960" height="540"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

const uiHp = document.getElementById("hp");
const uiScore = document.getElementById("score");
const msg = document.getElementById("msg");

const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function rect(x,y,w,h,c){
  ctx.fillStyle = c;
  ctx.fillRect(x,y,w,h);
}
function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

const gravity = 0.7;
const groundY = 420;

let cameraX = 0;
let score = 0;
let gameOver = false;

const player = {
  x: 120,
  y: groundY,
  vx: 0,
  vy: 0,
  w: 40,
  h: 60,
  hp: 100,
  facing: 1,
  atkCooldown: 0,
  state: "idle"
};

let enemies = [];
let particles = [];

function spawnEnemy(){
  let spawnX = cameraX + canvas.width + 200 + Math.random()*200;
  enemies.push({
    x: spawnX,
    y: groundY,
    vx: 0,
    vy: 0,
    w: 42,
    h: 62,
    hp: 35,
    facing: -1,
    hitstun: 0,
    atkCooldown: 0
  });
}

function overlaps(a,b){
  return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
}

function hitSpark(x,y){
  for(let i=0;i<6;i++){
    particles.push({
      x,y,
      vx:(Math.random()*4-2),
      vy:(Math.random()*-3),
      life: 18,
      color: Math.random()<0.5 ? "#ffcc00" : "#ff0033"
    });
  }
}

function attackBox(fighter, type){
  let range = type==="kick" ? 55 : 40;
  let ax = fighter.facing===1 ? fighter.x + fighter.w : fighter.x - range;
  let ay = fighter.y + 20;
  return {x:ax, y:ay, w:range, h:25};
}

function damageEnemy(enemy, dmg){
  enemy.hp -= dmg;
  enemy.hitstun = 10;
  enemy.vx += player.facing * 5;
  hitSpark(enemy.x+enemy.w/2, enemy.y+20);
  score += dmg * 2;
}

function playerAttack(type){
  const box = attackBox(player, type);

  enemies.forEach(e=>{
    if(e.hp>0){
      const eb = {x:e.x, y:e.y, w:e.w, h:e.h};
      if(overlaps(box, eb)){
        let dmg = type==="kick" ? 15 : 10;
        if(Math.random() < 0.12) dmg *= 2;
        damageEnemy(e, dmg);
      }
    }
  });
}

function drawPlayer(){
  // shadow
  rect(player.x-5 - cameraX, player.y+player.h, player.w+10, 6, "rgba(0,0,0,0.5)");

  // legs
  rect(player.x+6 - cameraX, player.y+42, 10, 18, "#00ccff");
  rect(player.x+24 - cameraX, player.y+42, 10, 18, "#00ccff");

  // torso
  rect(player.x+6 - cameraX, player.y+18, 28, 28, "#00ccff");

  // head
  rect(player.x+10 - cameraX, player.y+2, 20, 18, "#ffcc00");

  // eyes
  rect(player.x + (player.facing===1?20:14) - cameraX, player.y+8, 3, 3, "#000");
  rect(player.x + (player.facing===1?26:20) - cameraX, player.y+8, 3, 3, "#000");

  // arm
  if(player.state==="punch" || player.state==="kick"){
    rect(player.x + (player.facing===1?32:-10) - cameraX, player.y+22, 20, 8, "#fff");
  } else {
    rect(player.x + (player.facing===1?32:-6) - cameraX, player.y+22, 14, 8, "#fff");
  }

  // name
  ctx.fillStyle="#aaa";
  ctx.font="12px monospace";
  ctx.fillText("Erg√ºnus", player.x-6 - cameraX, player.y-8);
}

function drawEnemy(e){
  rect(e.x-5 - cameraX, e.y+e.h, e.w+10, 6, "rgba(0,0,0,0.5)");

  rect(e.x+6 - cameraX, e.y+42, 10, 18, "#ff0033");
  rect(e.x+24 - cameraX, e.y+42, 10, 18, "#ff0033");

  rect(e.x+6 - cameraX, e.y+18, 28, 28, "#ff0033");
  rect(e.x+10 - cameraX, e.y+2, 20, 18, "#bbb");

  rect(e.x+14 - cameraX, e.y+8, 3, 3, "#000");
  rect(e.x+20 - cameraX, e.y+8, 3, 3, "#000");

  rect(e.x + (e.facing===1?32:-6) - cameraX, e.y+22, 14, 8, "#000");

  ctx.fillStyle="#aaa";
  ctx.font="11px monospace";
  ctx.fillText("√áarrak NPC", e.x-10 - cameraX, e.y-8);

  // hp bar
  rect(e.x - cameraX, e.y-18, e.w, 6, "#222");
  rect(e.x - cameraX, e.y-18, (e.hp/35)*e.w, 6, "#ffcc00");
}

function drawBackground(){
  rect(0,0,canvas.width,canvas.height,"#0b0b0b");

  // parallax buildings
  for(let i=0;i<80;i++){
    let bx = i*60 - (cameraX*0.3 % 60);
    let h = 60 + (i%7)*20;
    rect(bx, 280-h, 50, h, "rgba(255,255,255,0.05)");
  }

  // floor
  rect(0, groundY+60, canvas.width, canvas.height, "#050505");
  rect(0, groundY+55, canvas.width, 10, "#222");

  // road marks
  for(let i=0;i<25;i++){
    rect(i*50 - (cameraX % 50), groundY+58, 20, 2, "rgba(255,0,51,0.25)");
  }

  ctx.fillStyle="#ffcc00";
  ctx.font="18px monospace";
  ctx.fillText("SIDE-SCROLLER: PATLAKLIK YAYILIYOR", 20, 30);
}

function update(){
  if(gameOver) return;

  if(keys["w"] && player.y >= groundY){
    player.vy = -12;
  }

  if(keys["a"]){
    player.vx = -3.5;
    player.facing = -1;
  } else if(keys["d"]){
    player.vx = 3.5;
    player.facing = 1;
  } else {
    player.vx *= 0.75;
  }

  player.atkCooldown = Math.max(0, player.atkCooldown-1);

  if(keys["j"] && player.atkCooldown <= 0){
    player.state="punch";
    player.atkCooldown = 20;
    playerAttack("punch");
  } else if(keys["k"] && player.atkCooldown <= 0){
    player.state="kick";
    player.atkCooldown = 30;
    playerAttack("kick");
  } else {
    if(player.atkCooldown < 8) player.state="idle";
  }

  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  if(player.y > groundY){
    player.y = groundY;
    player.vy = 0;
  }

  // camera follows player
  cameraX = player.x - 200;
  if(cameraX < 0) cameraX = 0;

  // enemy logic
  enemies.forEach(e=>{
    if(e.hp <= 0) return;

    e.hitstun = Math.max(0, e.hitstun-1);
    e.atkCooldown = Math.max(0, e.atkCooldown-1);

    let dist = player.x - e.x;
    e.facing = dist>0 ? 1 : -1;

    if(e.hitstun > 0){
      e.vx *= 0.8;
    } else {
      if(Math.abs(dist) > 70){
        e.vx = e.facing * 2.1;
      } else {
        e.vx *= 0.8;
        if(e.atkCooldown <= 0){
          // attack
          e.atkCooldown = 40;
          if(Math.random() < 0.7){
            // hit player
            player.hp -= 8;
            hitSpark(player.x+player.w/2, player.y+20);
          } else {
            player.hp -= 12;
            hitSpark(player.x+player.w/2, player.y+20);
          }
        }
      }
    }

    e.vy += gravity;
    e.x += e.vx;
    e.y += e.vy;

    if(e.y > groundY){
      e.y = groundY;
      e.vy = 0;
    }
  });

  // remove dead enemies occasionally
  enemies = enemies.filter(e => e.hp > -20);

  // spawn enemies if not enough
  if(enemies.filter(e=>e.hp>0).length < 4 && Math.random() < 0.05){
    spawnEnemy();
  }

  // particles
  particles.forEach(p=>{
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.2;
    p.life--;
  });
  particles = particles.filter(p=>p.life>0);

  // update UI
  uiHp.textContent = player.hp;
  uiScore.textContent = score;

  // hide intro
  if(keys["w"]||keys["a"]||keys["s"]||keys["d"]||keys["j"]||keys["k"]) {
    msg.style.display = "none";
  }

  if(player.hp <= 0){
    gameOver = true;
    msg.style.display="block";
    msg.innerHTML = "üíÄ ERG√úNUS MAXIMUS D√ú≈ûT√ú<br><span style='font-size:16px;'>Patlaklƒ±k kazandƒ±.</span><br><br>Sayfayƒ± yenile";
  }
}

function draw(){
  drawBackground();

  // draw enemies
  enemies.forEach(e=>{
    if(e.hp > 0) drawEnemy(e);
  });

  // draw player
  drawPlayer();

  // particles
  particles.forEach(p=>{
    ctx.globalAlpha = p.life/18;
    rect(p.x - cameraX, p.y, 4, 4, p.color);
    ctx.globalAlpha = 1;
  });
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

// initial enemies
for(let i=0;i<3;i++) spawnEnemy();

loop();
</script>

</body>
</html>
