<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ErgÃ¼nus Maximus Arena Fighter</title>
<style>
  body { margin:0; background:#000; color:#fff; font-family:Arial; overflow:hidden; }
  canvas { display:block; margin:0 auto; background:#111; image-rendering: pixelated; }
  .hud {
    position: absolute; left: 0; top: 0; width: 100%;
    display:flex; justify-content:space-between;
    padding:10px; font-size:14px;
    text-shadow:0 0 5px #000;
  }
  .bar {
    width: 300px; height: 18px;
    border:2px solid #fff; background:#222;
    position: relative;
  }
  .fill {
    height:100%; width:100%;
    background: linear-gradient(90deg, #00ff66, #ffcc00, #ff0033);
  }
  .centerText {
    position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%);
    font-size:28px; font-weight:bold;
    text-shadow:0 0 10px #000;
    text-align:center;
    pointer-events:none;
  }
</style>
</head>
<body>

<div class="hud">
  <div>
    <b>ERGÃœNUS MAXIMUS</b>
    <div class="bar"><div id="pHP" class="fill"></div></div>
  </div>

  <div style="text-align:right;">
    <b>BOSS: PATLAK KRAL</b>
    <div class="bar"><div id="eHP" class="fill"></div></div>
  </div>
</div>

<div class="centerText" id="centerText">WASD Hareket<br>J Yumruk | K Tekme | Space Dash</div>

<canvas id="game" width="960" height="540"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const pHPBar = document.getElementById("pHP");
const eHPBar = document.getElementById("eHP");
const centerText = document.getElementById("centerText");

ctx.imageSmoothingEnabled = false;

const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

function rect(x,y,w,h,c){
  ctx.fillStyle = c;
  ctx.fillRect(x,y,w,h);
}

function pixelText(text, x, y, size=14, color="#fff"){
  ctx.fillStyle = color;
  ctx.font = size + "px monospace";
  ctx.fillText(text, x, y);
}

function hitSpark(x,y){
  for(let i=0;i<6;i++){
    particles.push({
      x, y,
      vx:(Math.random()*4-2),
      vy:(Math.random()*-3),
      life: 18,
      color: Math.random()<0.5 ? "#ffcc00" : "#ff0033"
    });
  }
}

let particles = [];

const gravity = 0.7;
const groundY = 430;

const player = {
  name:"ErgÃ¼nus Maximus",
  x: 250, y: groundY,
  vx:0, vy:0,
  w: 40, h: 60,
  hp: 100, maxHp:100,
  facing: 1,
  state: "idle",
  animFrame: 0,
  animTimer: 0,
  attackCooldown: 0,
  dashCooldown: 0,
  hitstun: 0,
  combo: 0
};

const enemy = {
  name:"Patlak Kral",
  x: 700, y: groundY,
  vx:0, vy:0,
  w: 46, h: 66,
  hp: 160, maxHp:160,
  facing: -1,
  state: "idle",
  animFrame: 0,
  animTimer: 0,
  attackCooldown: 0,
  hitstun: 0,
  rage: 0
};

function attackBox(fighter, type){
  let range = type === "kick" ? 45 : 35;
  let height = type === "kick" ? 25 : 20;
  let ax = fighter.facing === 1 ? fighter.x + fighter.w : fighter.x - range;
  let ay = fighter.y + 20;
  return {x:ax, y:ay, w:range, h:height};
}

function overlaps(a,b){
  return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
}

function drawFighter(f, palette, isPlayer){
  // shadow
  rect(f.x-5, f.y+f.h, f.w+10, 6, "rgba(0,0,0,0.5)");

  // body (pixel art block style)
  let bodyColor = palette.body;
  let headColor = palette.head;
  let detail = palette.detail;

  // legs
  rect(f.x+6, f.y+42, 10, 18, bodyColor);
  rect(f.x+24, f.y+42, 10, 18, bodyColor);

  // torso
  rect(f.x+6, f.y+18, 28, 28, bodyColor);

  // head
  rect(f.x+10, f.y+2, 20, 18, headColor);

  // eyes
  rect(f.x + (f.facing===1?20:14), f.y+8, 3, 3, "#000");
  rect(f.x + (f.facing===1?26:20), f.y+8, 3, 3, "#000");

  // mouth
  rect(f.x+16, f.y+14, 10, 2, "#000");

  // aura glow when rage
  if(!isPlayer && enemy.rage > 60){
    ctx.globalAlpha = 0.25;
    rect(f.x-10, f.y-10, f.w+20, f.h+20, "#ff0033");
    ctx.globalAlpha = 1;
  }

  // arms (animated)
  let armOffset = 0;
  if(f.state === "punch") armOffset = 10;
  if(f.state === "kick") armOffset = 14;
  if(f.state === "dash") armOffset = 6;

  if(f.facing === 1){
    rect(f.x+32, f.y+22, 12+armOffset, 8, detail);
  } else {
    rect(f.x- (12+armOffset), f.y+22, 12+armOffset, 8, detail);
  }

  // name tag
  pixelText(f.name, f.x-10, f.y-10, 12, "#aaa");
}

function damage(target, amount){
  target.hp -= amount;
  if(target.hp < 0) target.hp = 0;
}

function enemyAI(){
  if(enemy.hitstun > 0) return;

  let dist = player.x - enemy.x;
  let abs = Math.abs(dist);

  enemy.facing = dist > 0 ? 1 : -1;

  // rage increases when losing
  enemy.rage = (1 - enemy.hp/enemy.maxHp) * 100;

  // move toward player
  if(abs > 110){
    enemy.vx = enemy.facing * (2.2 + enemy.rage*0.03);
    enemy.state = "walk";
  } else {
    enemy.vx *= 0.8;
    if(enemy.attackCooldown <= 0){
      // random attack choice
      if(Math.random() < 0.55){
        enemy.state = "punch";
        enemy.attackCooldown = 35;
      } else {
        enemy.state = "kick";
        enemy.attackCooldown = 45;
      }
    } else {
      enemy.state = "idle";
    }
  }
}

function doAttack(attacker, defender, type){
  const box = attackBox(attacker, type);
  const defBox = {x:defender.x, y:defender.y, w:defender.w, h:defender.h};

  if(overlaps(box, defBox)){
    let base = type==="kick" ? 14 : 10;
    let crit = Math.random() < 0.15;
    let dmg = crit ? base*2 : base;

    damage(defender, dmg);
    defender.hitstun = 12;
    defender.vx += attacker.facing * 6;
    hitSpark(defender.x + defender.w/2, defender.y + 20);

    if(attacker === player){
      player.combo++;
    } else {
      player.combo = 0;
    }

    // screen shake
    shake = 8;

    return true;
  }
  return false;
}

let shake = 0;
let gameOver = false;

function update(){
  if(gameOver) return;

  // hide intro after action
  if(keys["w"]||keys["a"]||keys["s"]||keys["d"]||keys["j"]||keys["k"]||keys[" "]) {
    centerText.style.display = "none";
  }

  // cooldowns
  player.attackCooldown = Math.max(0, player.attackCooldown-1);
  player.dashCooldown = Math.max(0, player.dashCooldown-1);
  enemy.attackCooldown = Math.max(0, enemy.attackCooldown-1);

  player.hitstun = Math.max(0, player.hitstun-1);
  enemy.hitstun = Math.max(0, enemy.hitstun-1);

  // player controls
  if(player.hitstun <= 0){
    let speed = 3.2;

    if(keys["a"]){ player.vx = -speed; player.facing=-1; player.state="walk"; }
    else if(keys["d"]){ player.vx = speed; player.facing=1; player.state="walk"; }
    else player.vx *= 0.75;

    if(keys["w"] && player.y >= groundY){ player.vy = -12; player.state="jump"; }

    // dash
    if(keys[" "] && player.dashCooldown <= 0){
      player.state="dash";
      player.vx = player.facing * 12;
      player.dashCooldown = 55;
      shake = 4;
    }

    // punch
    if(keys["j"] && player.attackCooldown <= 0){
      player.state="punch";
      player.attackCooldown = 18;
      doAttack(player, enemy, "punch");
    }

    // kick
    if(keys["k"] && player.attackCooldown <= 0){
      player.state="kick";
      player.attackCooldown = 28;
      doAttack(player, enemy, "kick");
    }
  }

  // enemy AI
  enemyAI();

  // enemy attacks
  if(enemy.state==="punch" && enemy.attackCooldown === 30){
    doAttack(enemy, player, "punch");
  }
  if(enemy.state==="kick" && enemy.attackCooldown === 38){
    doAttack(enemy, player, "kick");
  }

  // physics
  player.vy += gravity;
  enemy.vy += gravity;

  player.x += player.vx;
  player.y += player.vy;

  enemy.x += enemy.vx;
  enemy.y += enemy.vy;

  // ground collision
  if(player.y > groundY){ player.y = groundY; player.vy=0; }
  if(enemy.y > groundY){ enemy.y = groundY; enemy.vy=0; }

  // bounds
  player.x = clamp(player.x, 40, canvas.width-80);
  enemy.x = clamp(enemy.x, 40, canvas.width-80);

  // update hp bars
  pHPBar.style.width = (player.hp/player.maxHp*100) + "%";
  eHPBar.style.width = (enemy.hp/enemy.maxHp*100) + "%";

  // particles
  particles.forEach(p=>{
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.2;
    p.life--;
  });
  particles = particles.filter(p=>p.life>0);

  // game end
  if(player.hp <= 0){
    gameOver = true;
    centerText.style.display = "block";
    centerText.innerHTML = "ðŸ’€ ERGÃœNUS MAXIMUS YIKILDI<br><span style='font-size:18px;'>Boss: 'ben zaten kazandÄ±m' dedi.</span><br><br>SayfayÄ± yenile";
  }

  if(enemy.hp <= 0){
    gameOver = true;
    centerText.style.display = "block";
    centerText.innerHTML = "ðŸ† ZAFER! PATLAK KRAL DÃœÅžTÃœ<br><span style='font-size:18px;'>ErgÃ¼nus: 'ben zaten sigma'yÄ±m' dedi.</span><br><br>SayfayÄ± yenile";
  }
}

function drawBackground(){
  // sky
  rect(0,0,canvas.width,canvas.height,"#0b0b0b");

  // fake pixel city
  for(let i=0;i<40;i++){
    let bx = i*30;
    let h = 50 + Math.random()*120;
    rect(bx, 280-h, 26, h, "rgba(255,255,255,0.06)");
  }

  // floor
  rect(0, groundY+60, canvas.width, canvas.height, "#050505");
  rect(0, groundY+55, canvas.width, 10, "#222");

  // neon lines
  for(let i=0;i<20;i++){
    rect(i*50, groundY+58, 20, 2, "rgba(255,0,51,0.3)");
  }

  pixelText("ARENA: Ã‡ARRAK DÄ°YARI", 20, 30, 18, "#ffcc00");
  pixelText("Combo: " + player.combo, 20, 55, 14, "#aaa");
}

function draw(){
  let sx = 0, sy = 0;
  if(shake > 0){
    sx = Math.random()*shake - shake/2;
    sy = Math.random()*shake - shake/2;
    shake *= 0.85;
    if(shake < 0.5) shake = 0;
  }

  ctx.save();
  ctx.translate(sx, sy);

  drawBackground();

  drawFighter(player, {body:"#00ccff", head:"#ffcc00", detail:"#fff"}, true);
  drawFighter(enemy, {body:"#ff0033", head:"#bbb", detail:"#000"}, false);

  // particles
  particles.forEach(p=>{
    ctx.globalAlpha = p.life/18;
    rect(p.x, p.y, 4, 4, p.color);
    ctx.globalAlpha = 1;
  });

  ctx.restore();
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
